# {{.Title}}

## Table of Contents

- [Context](#context)
- [Services](#services)
{{- range .Services }}
  - [{{.Name}}](#{{Anchor .Name}})
{{- end }}
- [Channels](#channels)
{{- range .Channels }}
  - [{{.}}](#{{Anchor .}})
{{- end }}
{{- if .Changelogs }}
- [Changelog](#changelog)
{{- end }}

## Context

![Context](diagrams/context.svg)

## Services

{{- range .Services }}

### {{.Name}}

{{.Description}}

![{{.Name}} Service Channels](diagrams/service_{{Anchor .Name}}.svg)

{{- end }}

## Channels

{{- range .Channels }}

### {{.}}

![{{.}} Channel Services](diagrams/channel_{{Anchor .}}.svg)

{{- $channelInfo := index $.ChannelInfo . }}
{{- if $channelInfo.Messages }}

#### Messages

{{- range $channelInfo.Messages }}

{{- if or (eq .Direction "request") (eq .Direction "reply") }}
**{{.Direction}}**: {{.Name}}
{{- else }}
**{{.Name}}**
{{- end }}

{{- if .Payload }}
```json
{{.Payload}}
```
{{- end }}

{{- end }}
{{- end }}

{{- end }}

{{- if .Changelogs }}

## Changelog

{{- range SortChangelogs .Changelogs }}

### {{.Date.Format "2006-01-02"}}

{{- if .Changes }}
{{- range .Changes }}
- **{{.Type}}** {{.Category}}: {{.Details}}
{{- if .Diff }}
```json
{{.Diff}}
```
{{- end }}
{{- end }}
{{- else }}
- No changes detected
{{- end }}

{{- end }}

{{- end }}